---------------------------------------------------------------------------------------------------------
INTRODUCTION: 
---------------------------------------------------------------------------------------------------------

NOTE: From Nov 2022, exam pattern is changing for Solution Architect - Professional.

---------------------------------------------------------------------------------------------------------
AWS ACCOUNTS: 
---------------------------------------------------------------------------------------------------------

Introduction: 

    AWS Account is container for identity (users) and resources. 

    Account Root user - Create account with unique email address and using credit card. It has full access control to aws resources. 

    By default all access to aws account & resources are DENIED except for Account root user. It requires to explicit ALLOW to access resources. 


Multi Factor Authentication: 

    Factors - It is different pieces of evidences which prove identity.
    
    Multi Factors - Multiple factors to prove idendity. 
    
    Types of factors: 
        Knowledge   -   username & password 
        Possession  -   card # , MFA device. 
        Inherent    -   fingerprint, iris 
        Location    -   location of user. 

    More factors means more security. 

    In AWS, based on username and password generates the KEY + other information in QR format which can be scanned to generate the verification code. 


Securing an AWS Account: 

    Using MFA: 

        Select root account -> Security Credentials. 


Creating budget: 

    Cost explorer provides reporting, analytics and visualization capabilities that can use to track and manage aws costs. 

            root account -> Billing dashboard -> cost management -> cost explorer 

    AWS budget is used to set custom budget to alert when threshold is reached. It requires cost explorer to be enabled to work. 

            root account -> Billing dashboard -> cost management -> budget 

            Create Budget: 
                    1. Select budget limit, budget name 
                    2. Select email recepients. 
                    3. Can select SNS target. 


Creating production account: 

    Create a brand new account as production with MFA feature and enable the budget alert. 


Adding an IAM Admin: 

    IAM -> Users -> Attach permission directly.

    IAM -> Users -> Group -> In group, attach permission

    https://meeran-general.signin.aws.amazon.com/console
    https://meeran-production.signin.aws.amazon.com/console


IAM Access Keys:     

    username and password is single attached to user. 

    access key can be multiple and can be enable, disable and delete. 

    aws configure --profile profile-name 


---------------------------------------------------------------------------------------------------------
ADVANCED PERMISSIONS AND ACCOUNTS: 
---------------------------------------------------------------------------------------------------------

AWS ORGANIZATIONS: 

    Each organization requires multiple accounts and managing separately is tedious if account increases.
    
    With AWS Organization, accounts are managed.

    Management account is from which account organization is created. 

    Master or Management or payer account. Using management account, can invite other accounts to join. Once joined, standard account become memeber account of organization.

    Using AWS organization, can create new account directly or invite existing account. 

    Consolidated billing features. 

    Service Control Policy 

    General practice is to create separate accounts for payments (management), user account (integraet with federation iddendity). From user account, do switch role to assume the role in other accounts. 


    CONSOLE: 

        Create Organization:  

            account -> organization -> create organization -> Automatically added as management account. 

        Invite the account: 

            account -> organization -> Add an AWS account -> Send Invite to existing account. 

        Accept the invitation: 

            account -> organization -> Invitations -> Accept Invitations 

        Create Account: 

            account -> organization -> create account -> unique email + name + rolename 

        Create Organization Unit (OU): 

            account -> organization -> Root -> Create organization 


    ROLE SWITCH: 

        For account created using organization, ROLE (OrganizationAccountAccessRole) is created automatically and can be use switch role.

        For invited account, requires to create the role. 

        CREATE ROLE IN INVITED ACCOUNT FOR MANAGEMENT ACCOUNT TO USE FOR ROLE SWITCH: 

            IAM -> Role -> AWS Account -> Management account nbr -> Attach policy 

        TO SWITCH ROLE: 
            In AWS Organization, it helps administrator to easily manage accounts. 

            From management account -> account -> Switch Role -> 
    
    
    SERVICE CONTROL POLICY: 

        It is a JSON policy and can be attached at Root level, OU level or account level. 

        If attached at root level, then affect all OU and accounts. If at OU level, affect the accounts under the OU.

        NOTE: Management account cannot be affect by this SCP at any level. 

        SCP doesnot grant any permission but it is account level permission boundaries. 

        Account root user has full access in account but indirectly can be restricted by using SCP.

        Access can be provided by 2 ways, 
            1. Explicit allow all (default policy) and explicit deny few services.
            2. Delete default and Explicit allow few services only. (more secure)

            Implicit Deny -> Explicit Allow -> Explicit Deny 

        CONSOLE: 
            1. First to enable the SCP: 
                    Organization -> Policy -> SCP -> ENABLE (Default create with FullAWSAccess policy) and attach to ROOT by default.

---------------------------------------------------------------------------------------------------------

SECURITY TOKEN SERVICE (STS):

    Whenever role is assumed, it pass to STS:AssumeRole*.

    User -> Assume a Role -> STS -> Check Identity maintained in Trust policy   -> If allowed, then get the permission -> Return access key, secret id, session token & expiration date. 
    
    STS does 2 things, 
            1. Check trust policy is maintained. 
            2. If maintained, get the permission policy and return the access details.

    Identity can be switch role, cross account role and other AWS resources. 


REVOKING IAM ROLE TEMPORARY SECURITY CREDENTIALS: 
    
    Temporary credentials cannot be manually cancelled or invalidated and it is valid till expiry time.

    Incase if temporary credentials are compromised, "Revoke session" is used to add a conditional deny policy which DENY any session assumed < NOW. So legitimate users can assume the role again but illegitimate users cant assume again.

    During Revoke session, it will add "AWSRevokeOlderSessions" inline policy to role. 

    CONSOLE: 

        IAM -> Role -> View Role -> Revoke Sessions -> Revoke active sessions. 

                    "Condition": {
                        "DateLessThan": {
                            "aws:TokenIssueTime": "[policy creation time]"
                        }
                    }

---------------------------------------------------------------------------------------------------------

POLICY INTERPRETATION: 

    Implicit Deny -> Explicit Allow -> Explicit Deny 

    {
        Version: "2012-"
        Statement: [{
            Sid: "statement id 1"
            Effect: "allow" or "deny"
            Action: ["s3*", "ec2*"]  or NotAction: []
            Resource: "s3*"
            Condition: {}
        }, {}, {}]
    }

    NOTE: If single statement with DENY effect. It is no useful because by default implicit DENY. So single statement with DENY is used in conjugation with other ALLOW policy.

    Concentrate on NotAction , StringNotEquals conditions.


PERMISSION BOUNDARIES: 

    This is at identity level. It doesnot grant any access. It limit the permission of the identity permission.

    It helps for delegation access. 

    For example: 
        Bob (admin) believes tom and want to give full iam:* access.
        This cause probelms, 
            Tom can change his own IAM permission.
            Create another user with administrator access.

    To solve this problem,
        1. Bob create a user boundary and allow only that user level access ${aws:user}
        2. Create user Tom and assign a permission boundary + policy not to change his identity + cant edit permission boundary. 


PERMISSIONS EVALUATION LOGIC: 

    For same account: 

        Explicit Deny -> SCP -> Resource Policy(Allowed then stops)  -> Permission Boundary -> Session Policy (Assume a Role) -> Identity policy 

    For cross account: 

        Account A (Identity policy) -> Account B (Resource policy)

        Account A to allow access to Account B <> Account B to allow access from Account A 

        Allow <> Allow  then Allow 
        Deny <> Allow   then Deny 
        Deny <> Allow   then Deny 

---------------------------------------------------------------------------------------------------------

CROSS ACCOUNT ACCESS TO S3: 

    ACL: 

        It is legacy method of giving permission and AWS no longer recommend this. 
        Account canonical user id 
        Whoever uploaded (owner) only have permission even bucket owner is different.

        1. Create the bucket in Account B. 
            a. Create the ACL access to allow from A. Use Account A Canonical name.
        2. From Account A, Switch Role to Account B.
        3. Upload the objects in Account B.
        4. Only Account A have access (owner) not Account B (Bucket owner).

        NOTE: "Object ownership" - helps to override this behaviour and allows bucket owner to own the object by default. 

        Objects owned by uploader. 

    Bucket Policy: 

        1. Create a bucket policy.  
                principal = Account A 
        2. Attach the policy to Account B
        3. From Account A, able to access Account B. 

        Objects owned by uploader. 

    Cross Account Role: 

        Objects owned by bucket owner. 

        1. Create a role with trust policy of cross account and s3 bucket permission.
        2. From Account A, switch role to s3 role.

---------------------------------------------------------------------------------------------------------

AWS RESOURCE ACCESS MANAGER (RAM): 

    Within organization, it helps to share resources at organization, OU and Account level.

    Only RAM supported products can be shared.

    No cost for RAM but cost for underlying resources used.

    It influences changes in traditional architecture.

    NOTE:   Availability zone in 1 account (us-east-1) is not same for another account (us-east-1)
            Availability zone ID (use1-az1) is consistent or same accross the accounts. 

    Owner Account:  Owns the resource and create a share. 
                    Owner retains full permissionship.
                    Defines the principal (org,ou,acc) to whom to share.
                    If participant inside an ORG, acceptance happen automatically. Any non ORG account, based on invite to accept. 
    
    USE CASE: 

        In organization, owner account create a VPC, Subnet & security group and shared with participant accounts.
        Participant accounts can only have Read access to utilize and cannot be modified.
        Only owner account can modify, delete resources.
        If participant account create ec2 instance under shared subnets, ec2 is owned by only participant account not owner account. 

    CONSOLE: 

        RAM -> Settings -> Enable Sharing within organization.

        RAM -> Create resource share -> Name, Resources, Organizations -> Create 

        Resources -> Shared by Me , Resources -> Shared with Me

        NOTE: Name is not tagged in shared resource and participant account can update name. One participant account created resource cannot seen by other participant accounts. 

---------------------------------------------------------------------------------------------------------

SERVICE QUOTAS: 

    Quota is limit on the AWS resources.

    Service normally have per region quota.

    Global services have account level quota.

    Most service quotas can be increased.

    Hard limit cannot be changes: 
        IAM user of 5000 per account.

    https://docs.aws.amazon.com/general/latest/gr/aws-service-information.html

    AWS -> Service Quotas -> AWS Resources.
        Quota Name, Applied Quota value, Aws default quota value, Adjustable
        View quota -> Request Quota Increase 

        View quota -> Monitoring. 
            If threshold is reached, then alarm the quota limit.

    Organization -> Quota Request Template.

    Support -> Ticket to increase quota limit.


---------------------------------------------------------------------------------------------------------
ADVANCED IDENTITIES AND FEDERATION: 
---------------------------------------------------------------------------------------------------------

SAML2.0 IDENTITY FEDERATION: 

    NOTE: AWS Only understand the AWS credentials to allow access to resources.

    Here using another identity provider to get identity to access AWS resources.

    SAML2 is used in enterprise identity federation.

    SAML2: 
        Security Assertion Markup language
        Many onpremise identity provider uses SAML2 

    use case: 
        If no of user > 5000
        Enterprise identity provider + SAML2 compatible
        If requires existing IAM team to manage with single source of identity truth.

    It uses IAM roles and Temporary security credential valid for 12 hours. 

    ARCHITECTURE for Application: 

        1. Trust relationship establish between Idp and IAM.
        2. Application call Idp which authenticated and return SAML assertion.
        3. Application call STS to get temporary credential.
        4. Application call AWS resources to access.

    ARCHITECTURE for USER LOGIN: 

        1. Trust relationship establish between Idp and SAML/SSO endpoint.
        2. Client call Idp which authenticated and return SAML assertion.
        3. CLient send the SAML assertion to SSO endpoint. 
        4. From SSO, call STS assume role.
        5. SAML Endpoint generate the URL and Client uses to access AWS console.

---------------------------------------------------------------------------------------------------------

AWS SINGLE SIGN ON (SSO): 

    It helps to centrally manage sso access and user permission for accounts in organization.

    Requirement is valid AWS organization is created.

    It is extension of AWS organization.

    AWS SSO supports multiple identity source, 
        built in identity stores.
        AWS Managed microsoft AD 
        On premise microsoft AD 
        External SAML2 identity

    AWS SSO is recommended. 

    https://jumpcloud.com/blog/aws-iam-vs-aws-sso


    CONSOLE: 

        AWS SSO -> Enable 

        https://d-9067b1117b.awsapps.com/start  - can customize the URL.

        Identity source -> AWS SSO, Active Directory, External Identity Provider.

        Permission sets -> Predefined or custom permission sets. Session duration can select.

        Users & Groups can be created.


        User portal URL: https://d-9067b1117b.awsapps.com/start, Username: sally, One-time password: 

        1. Create a user, group and permission sets.
        2. From aws account, assign user/group to account.
        3. Assign a permission (Permission Set Name is displayed).

        AWS SSO -> Applications -> Can integrate 3rd party applications.

    To enable MFA: 

        SSO -> Settings -> Network & Security -> MFA 

---------------------------------------------------------------------------------------------------------

AMAZON COGNITO - USER AND IDENTITY POOLS: 

    It provides authentication, authorization and user management for web/mobile applications.

    It consists of user pools and identity pools
        User Pools -    Signin and provide JWT (Json web token) and few AWS services accepts JWT like API gateway. 
                        It supports SAML2 , Facebook, login, Identity federation.
                        Used for signup and signin.

        identity pools -    It provides AWS credentials by exchange JWT.
                            Even user pool , google, saml2 identity used for exchange.
                            Swapping authenticated or unauthenticated identity for credentials.
                            Assume the role on behalf of identity.
                            It can deal both authenticated or unauthenticated identity.

    1. User is authenticated with external identity like google, facebook etc.
    2. User pools returns the JWT to web/mobile application.
    3. Web/mobile application send JWT to Identity Pool.
    4. Identity Pool assume the role and generate the temporary credentials.
    5. Identit pool return the temporary credentials to web/mobile application.

    CONSOLE: 

        Cognito -> Create a user pool 
        Cognito -> Identity pool or Federated identities.

---------------------------------------------------------------------------------------------------------

AMAZON WORKSPACE: 

    It is AWS Desktop As A Service.

    It uses directory services (simple AD or AD Connector) for user management and authentication.

    NOTE: Only support AWS Directory services (Simple AD, Microsoft AD & AD Connector)

    It consists of AWS Managed and Customer managed VPC.

    All management related services (AD, Workspace, authentication gateway) in AWS managed VPC.

    From AWS Managed VPC, these services interact with Customer managed VPC through ENI. From there it connect to VPN or Direct connect through Nat gateway and Internet gateway. 

    To function workspace, it requires Directory services and VPC.
    
---------------------------------------------------------------------------------------------------------

AWS MANAGED MICROSOFT AD: 

    Standard    -   support 5000 users and 30000 objects.
    Enterprise  -   Support upto 500,000 objects.

    If require native microsoft authentication, then recommend this.

    Can configure a trust relationship between AWS managed microsoft AD and On pprem microsoft AD, so users and groups access resources in either domain.

    Capable of operating independetly if link broken between onprem and aws.

    Can integrate with MFA (Radius based server).

    Support microsoft schema extension.

    Can establish two way trust between onprem and aws managed AD.

---------------------------------------------------------------------------------------------------------

AD CONNECTOR: 

    It appears as native directory.
    It send the request to onprem active directory and does not store any data.

    Useful in proof of concept and no need to keep AD in AWS.

    It consists of below based on compute power,
        Small
        Large

    It placed in 2 subnets with in VPC and requires 1 or more AD .

    It requires working network connectivity between AWS and On prem through Direct connect or VPN connection etc.

    Select only when,
    Proof of concept
    Legal or compliance reason not in AWS 


---------------------------------------------------------------------------------------------------------
NETWORKING AND HYBRID: 
---------------------------------------------------------------------------------------------------------

PUBLIC AND PRIVATE AWS SERVICES: 

    Public - Have public endpoint and accessed using internet.  
    Private - Runs within VPC.

    Public zone     -   act as interface between private and internet. From this zone, aws public service operates like s3 etc. 
    Private Zone    -   VPC 

    From private zone, resources like ec2 uses internet gateway to access internet.

    Private to private connection happen using VPN or direect connect. 

---------------------------------------------------------------------------------------------------------

DHCP IN VPC: 

    Dynamic Host Configuration Protocol - It helps automatic configuration of network resources. It is useful to assign dynamic IP to host.

    It consists of Client and Server, based on Layer 2 has MAC address.

    Inorder to work at Layer 3, minimum requires IP address, Subnet masks & Default gateway.

    In VPC,
        DNS Servers, NTP Server, Domain Name, NetBios 

    NOTE: Once DHCP Option sets created, it cannot be modified and immutable.
    
    Option set can be associated with 1 or more vpc. Each VPC have 1 DHCP option set.

    NOTE: Associate VPC with DHCP can happen immediately but to effect changes require "DHCP Renew"

---------------------------------------------------------------------------------------------------------

VPC ROUTER: 

    It helps to route traffic, 

        1. Between subnets.
        2. From external network to VPC
        3. From VPC to external network.
    
    It is highly available and across all AZ. 

    Router is attached to subnet level.Each subnet is associated with route table. 

    Subnet have interface with Router through ENI (Subnet ip address + 1)

    Router is managed by using route table.

    NOTE:   Subnets are associated with only one route table. Same route tables can be associated with many subnets. 

    /32 is higher priority than /16, /8 or /0.

    Route Table: 
        Destination     Target 
        10.0.0.0/16     local           (IP address is VPC CIDR range and mean local VPC)
        0.0.0.0/0       igw             (It matches all IP address and generally use to connect to internet)

    Packets contains source and destination IP address. Destination IP address is compared with destination prefix to route to the target.

---------------------------------------------------------------------------------------------------------

STATELESS VS STATEFUL FIREWALLS: 

    In Layer 4, TCP, uses the ephermal port to initiate the request from client to server in well known port.

    It is bidirectional and request/response process separately. 

    Stateless which doesnot understand the state of connection whether request or response, so requires both inbound and outbound rule. Since client port is ephermal so outbound is allowed always.

    security group is stateful because smart enough to get the response ip from the request details.


    NACL: 

        At subnet level.
        stateless.
        Since ephermal port require to allow all outbound port. 

    NOTE:   Default NACL, allow both inbound and outbound. 
            Custom NACL, denies both inbound and outbound.

        Deny is feature in NACL which helps to block IP ranges.


    SECURITY GROUP: 

        At ec2 level.
        Stateful.
        No need to allow outbound port.

        Major disadvantage is no explicit deny, so used in conjuction with NACL.

        NOTE: Security groups are not attached to instances but attached to ENI (Elastic Network Interfaces).

        It gives additional feature of logical reference of another security group. For example: In backend app-security-group, include the source as frontend-security-group.

        Also can self reference security group: 
                If self reference the security group and attach to multiple instances. It allow communication between them.

---------------------------------------------------------------------------------------------------------

BORDER GATEWAY PROTOCAL: 

    AS - Autonomous System
    ASN - Autonomous System Number
    It helps to find the shortest route to reach the destination.
    Each network has AS (Autonomous System) and ASN (Autonomous System Nbr).

    Border Gateway Peering is done which used to broadcast nearest network to their connected Border Gateway.

    ASPATH - Autonomous System Path - Contains the path details and from this chose the shortest path.

---------------------------------------------------------------------------------------------------------

AWS GLOBAL ACCELARATOR: 

    It helps to select the nearest edge location (network). 

    Lower number of hops , better the experience.

    Unicast IP address - Normal IP address.
    Anycast IP address - Multiple devices can use anycast IP address.

    It uses edge location (AWS Global Network)

    CloudFront - Keep content close to customer. Works on content cache. It caches only HTTP/HTTPS product.
    Global Accelarator - Keep network close to customer. It is network product works on TCP/UDP. Doesnot cache anything. 
    
---------------------------------------------------------------------------------------------------------

SITE TO SITE VPN CONNECTION:

    It helps to connect from VPC to non AWS (onprem network/another cloud).

    It consists of Virtual Private Gateway (VGW) on AWS side and Customer Gateway(CGW) on On-prem side. VPN connection between VGW and CGW.

    Both CGW and VGW is on top of router.

    Communication is encrypted in transit by using IPSec tunnel. It runs over the public internet except direct connect. 

    VGW has 2 end points in different availability zone. 

    On AWS Side, have 2 VPN connection to customer side for high availability. 

    NOTE: Only AWS Side have high availability, to make it fully high available, requires 2 customer gateway in on-prem side.

    Static VPN   -   Static networking configuration like IP address of CGW and VGW need to maintain on both side.
    Dynamic VPN  -   If BGP (border gateway protocol) enabled, then only can use the dynamic IP. Route propagation on Route table helps to enable dynamic. 

    STEPS: 
        1. Collect the IP address of VPC and Router details in AWS and Onprem side.
        2. Attach the VGW in public zone of AWS and CGW in Router of customer side.
        3. In VGW, created with 2 endpoints in different AZ. This end point is used to connecto to CGW.
        4. Create a static or dynamic VPN connection.
        5. VPN connection is linked to VGW endpoints and this endpoint is connect to CGW.
    
    Limitation: 
        1. To check speed limit of 1.25 gbps on both tunnel.
        2. It transit through internet and latency can cause issue.
        3. Hourly cost, data transfer cost.
    
    NOTE: It can setup fastly in hours. 

---------------------------------------------------------------------------------------------------------

AWS CLIENT VPN: 

    It helps to connect AWS to Client.

    Site to Site VPN connection which connects AWS to Non AWS like On-prem, another cloud.
    Client VPN connects AWS with Client.

    Client should be Open VPN supported.

    NOTE: Without Split tunnel , connects to internet through client VPN.

    XXXXXXXX - REQUIRE TO DEEP DIVE

---------------------------------------------------------------------------------------------------------

AWS DIRECT CONNECT: 

    It is physical connection beween on-prem and AWS

    XXXXXXXX - REQUIRE TO DEEP DIVE

---------------------------------------------------------------------------------------------------------

ROUTE 53 FUNDAMENTALS:

    It is AWS managed DNS product.

    It provides 2 main functions,
        1. Register domain
        2. Host zones (hosted zone) and managed nameserver.

    It is global service and have single database.

    It creates the zone file and nameserver and place the zone file in nameserver and place the nameserver details in high level domain like .org by adding name server record.

    Inside hosted zone has recordset (records)

    
REGISTERING A DOMAIN: 

    It consists of domain name registration + name server details. Both are separate things, 
        One can register a domain name in AWS or external and nameserver also can use external or AWS one.

    In AWS, create with 4 nameservers in high availability zone.


DNS RECORD TYPES:

NS      -   NameServer      -   It Points to nameserver details. 
A       -   IPV4 Address    -   It points WWW to IPV4 address.
AAAA    -   IPV6 Address    -   It points WWW to IPV6 address. 
CNAME   -   Canonical Name  -   It points to another domain. CNAME ftp CMAN www
TTL     -   Time To Live    -   How much time to active in Resolver server. 
MX      -   Main Server     -   It points to Mail Server.
    MX 10 mail 
    MX 20 mail.domain.org 

    10, 20 is priority.

TXT     -   Text Record     -   It uses to prove domain ownership.


ROUTE 53 PUBLIC HOSTED ZONE:

    It is zone file which is database of zone file. Hosted zone is located in public and access through internet.
    In Route 53, have 4 public hosted zone.
    It can be resolved through from public internet and VPC.
    Route 53 resolver is VPC + 2 ip address.


ROUTE 53 PRIVATE HOSTED ZONE: 

    Hosted zone is placed within VPC and cannot be resolved from public internet.
    Only with in VPC, can resolve the private hosted zone.

    Split view is concept of using public and private hosted zone together. Private use for internal users and public for other users. 

    In split view, few records can be public (www 12.12.13.14) and few records can be private (accouting 13.14.15.16)

    It tagged to VPC. Multiple VPC can be tagged. Only can access from tagged VPC.


CNAME VS ROUTE 53 ALIAS:    

    CNAME doesnot support Naked/apex domain. (www.google.com <> google.com)
    Naked domain is google.com
    Normal domain is www.google.com

    ALIAS is AWS supported record type which used to point naked domain.

    Generally AWS resources like ELB points to DNS name.

    A record Alias
    CNAME record Alias.


SIMPLE ROUTING:

    It points WWW A record to IP address. 
    
    It doesnot have health check.


HEALTH CHECK: 

    It performs health check which separate from record set.

    By default checks for every 30 sec.

    It checks by establish TCP connection and respond through HTTP/HTTPS.

    It checks connectivity + words (string match) available response content.

    It is of 3 types,
        end point   -   based on IP/domain. create internally in multiple regions.
        calculated health check - use other health checks with AND/OR operation.
        Use cloud watch alarm.


MULTI VALUE ROUTING:

    It is combination of simple routing and fail over routing.
    It is single domain with multiple ip address.
    When client calls, it returns 8 records (ip address) and client choose randomly.
    When health check is failed, it will not return ip address to client.


WEIGHTED ROUTING:

    It is based on weightage.
    Each record have associated health check. 
    If health check is failed, then choose another record. 


GEO PROXIMITY ROUTING:

    It is based on the bias. If bias is larger, cover larger distance. If bias is small, cover smaller distance. 
    It is based on the location of server.


GEO LOCATION ROUTING:

    It is based on record set is tagged to country or continent.
    Useful for content delivering based on country.
    IP address is used to take the country.


FAILOVER ROUTING:

    It is based on active passive type.
    Primary is attached to health check. If primary failed, it route to secondary.


LATENCY BASED ROUTING: 

    It is based on the latency or quickest server to select for the record set. 
    It consists of region tagged to server.


ROUTE 53 INTEROPERABILITY: 

    It consists of 2 parts,
        Domain registration -   Register the website in HLD using nameserver and domain name.
        Domain hosting - Create the name server and this name server used to register. 

    Both are separate process and can use AWS in either part.


---------------------------------------------------------------------------------------------------------
STORAGE SERVICES: 
---------------------------------------------------------------------------------------------------------

FSx FOR WINDOWS SERVER: 

    This is like EFS but for windows server.It is Fully managed native windows file servers.
    Designed for to integrate with file servers.
    Can integrate with directory service or self managed AD.
    Can deploy in single or multi AZ within VPC.
    It support ondemand or scheduled backups.

    Can be accessible using VPC, VPC peering, VPN connection, Direct connection.

    It supports de-duplication, DFS(Distributed file system), KMS at rest and encryption in-transit.

    Support file level versioning (volume shadow copies)

    \\fs-xxxx.domain-name\file-name 

    VSS - User driven restores 
    Native file system accessible over SMB (Server Message Block). EFS uses NFS protocol. 
    Uses windows permission model.
    Support DFS (scale out file share structure)

    AWS managed - No server admin.
    Integrates with Directory Service or your own directory.
    NOTE: Simple AD is not supported.

---------------------------------------------------------------------------------------------------------

FSX FOR LUSTRE:

    Defined specifically high performance computing Linux clients (posix)

    used for machine learning, bigdata, financial modelling.

    Deploy in single AZ.

    100 gb/s throughput and sub millisecond latency.

    Deployment types: 
        Scratch: 
            for short term. 
        Persistent: 
            for longer term , high availability, self healing.

    can be accessible over vpn or direct connect.

    At architecture level, it consists of:
        Metadata Targets (MDT)
        Object Storage Target (OST)

    It uses ENI to connect to FSx for lustre.

---------------------------------------------------------------------------------------------------------

EFS (ELASTIC FILE SYSTEM): 

    Support POSIX.

    It is based on NFSv4 (Network file system) which can be mounted oon EC2.

    It helps to store data outside of EC2 which doesnot lost.

    Same EFS can be mounted on multiple EC2 instances.

    EBS is block storage but EFS is file storage.

    Can be accessed from onprem using VPN or direct connect, vpc peering.

    It consists of,
        General Purpose 
        Max IO 

    Throughput modes,
        Bursting 
        Provisioned 

    Storage Classes, 
        Standard 
        Infrequent access

    Can use lifecycle policies to move data between different classes.

---------------------------------------------------------------------------------------------------------

S3 OBJECT STORAGE VS EBS BLOCK VS EFS FILE STORAGE: 

    OBject storage think of any videos, pictures, etc.
    Block storage is attached to single instances.
    File storage is attached to multiple instances.

---------------------------------------------------------------------------------------------------------

S3 OBJECT STORAGE CLASS: 

    From s3 standard to s3 glacier , can move in 1 day.
    In life cycle policy. move from IA to glacier only after 30 days.
    For CRR, only support KMS & SSE-S3.
    In CRR, objects not owned by source bucket are not replicated , replication is not retroactive or replication doesnot support SSE-C

    S3 STANDARD: 
        It is default storage class and object data is replicated across 3 AZ.
        It provides 99.99999999999 (11 9s) durability.

        data store is cost + out data transfer cost.
        It should be used for frequently access data.

    S3 STANDARD IA: 
        It is same as standard.
        It includes retrieval fee.
        It has minimum duration charge of 30 days.
    
    S3 ONE ZONE IA: 
        It stores the data in single AZ.
        Use only for data can be regenerate or lose is fine.
        It has minimum duration charge of 30 days like IA.
    
    S3 GLACIER INSTANT RETRIVAL: 
        Its like standard IA.
        Minimum storage duration charge is 90 days.
        More expense retrival costs.
        Data can be accessed instantly and doesnot require any retrival process like standard s3 but higher cost.

    S3 GLACIER FLEXIBLE RETRIVAL:
        Cost is 1/6th of standard s3.
        It requires retrival process to get the object.
        Expedited - 1 to 5 mins
        Standard - 3 - 5 hrs 
        bulk - 5 to 12 hrs 
        Cant make the object public and data not available immediately.
        
    S3 GLACIER DEEP ARCHIVE: 

        180 minimum billable duration.
        Jobs retrieved to standard IA and take much longer time to retrieve.

    S3 INTELLIGENT TEARING: 

        Object moved from one class to another depends upon duration of access.


    S3 LIFE CYCLE CONFIGURATION: 

        It provides different capabilities, 
            move current version between storage class 
            move non current version between storage class 
            Expire current version of objects 
            permanently delete non current version of objects 
            delete expired object delete markers or incompatible multipart upload.

        Can move from one storage class to another, 

            Standard IA     -   mininum 30 days
            Glacier Instant Retrieval - Minimum 30 days + standard ia retrival days. 
            Glacier flexible retrieval - Minimum 90 days
            Glacier deep archive - Minimum 180 days.


    S3 REPLICATION:

        It is used to store the data in another account or another region.
        Versioning should be enabled on both source and destination.
        Can select all objects or use prefix to limit or tags.

        It consist of,
            SRR - Same Region Application
            CRR - Cross region Replication 

        For cross account replication, requires bucket policy to trust the role from source.

        NOTE: Default storage class is standard but can override to choose other class.

        RTC (Replication Time Control) - have SLA of 15 mins.

        NOTE: Can replicate encrypted objects using SSe-S3, KMS but cannot replicate objects which encrypted by using SSE-C 

        Delete will not be replicated.


    S3 OBJECT ENCRYPTION: 

        NOTE: Only objects can be encrypted but bucket itself cannot be encrypted. 

        Server Side Encryption:
            Plain text data is uploaded by user and then encrypted and store by s3. s3 handle the encryption.
        
            SSE-S3  -   AWS handles both keys and Encryption/Decryption process.
            SSE-C   -   Customer is responsible for keys. Encryption/Decryption done by S3.
            SSE-KMS -   Key is handled separately by KMS. Customer managed key is generated. Used that key for encryption/decryption. It gives role separation by restrict access to CMK and rotation control. 

            AES256 algorithm used for encryprion.

            In CLI or API, while upload objects require to specify Header x-amz-server-side-encryption, with AES256 for SSE-S3 , aws:kms for KMS.  Default is AES256. 

        Client Side Encryption: 
            Data is encrypted by user and then upload the encrypted data in s3. 


    S3 PRESIGNED URL: 

        It is giving access to another person/application to access to private s3 bucket.
        If any unknown user wants to access temporarily to private s3 bucket.

        Process: 
            1. User/application send the "generate presigned url" request along with permission and expiry time to s3 bucket.
            2. s3 bucket generate the presigned url and return to user/application.
            3. From application, can return to user. 
            4. NOTE: While generate url request, application/user connected role will be sent.

        1. Can create presigned URL eventhough no access to object with expiry date.
        2. When use the URL, permission is using the identity permission.
        3. Dont generate presigned url with role because have temporary credential of short expiry.


    S3 SELECT AND GLACIER SELECT: 

        Both are used to retrieve parts of objects, pre filtered by s3.
        It is SQL like statements.
        It support CSV,JSON, Parquet, BZIP2 compression.
        Since it is s3 feature, it reduce cost in data transfer and faster.


    S3 ACCESS POINTS: 

        It simplies managing access to s3 bucket/objects.
        With bucket policy, it is more complex to manage multiple teams and hundres of objects.
        Can create many access points with each have different policies with different network control(from vpc or internet).
        Each access point has own endpoint address which can be used to access instead of common s3 endpoint.
        aws s3control create-access-point 
        By using policy, can restrict the access to specific object.

        NOTE: In bucket policy can give high level permission and in Access Point to give more granular access. if bucket policy denied, it will stop there.

        Can access from VPC using VPC endpoints and grant access using endpoint policy.

    
    S3 OBJECT LOCK: 

        During bucket creation, can lock the object. 
        To object lock for existing buckets, require to contact AWS support.
        Versioning also enabled and also versions also locked.
        Once created, cannot disable the object.
        It support Write Once Read Many.

        NOTE: Object lock settings can only be specified in CLI, API or SDK.

        It support retention,

            1. Retention Period -   User can specify retention period in days/years.

                    Compliance Mode -   Till expiry, no user include account root user cant change anything including deletion, overwritten. Cant change retention period.

                    Governance Mode -   Set of users can modify the object and settings can be adjusted. 
                    s3:BypassGovernanceRetention is used or x-amz-bypass-governance-retention header.

            2. Legal hold       -   Dont set retention period. Only on/off. No changes or delete until legal hold removed. Prevent accidental deletion.

---------------------------------------------------------------------------------------------------------

AMAZON MACIE: 

    It is a data security and data privacy service.
    Discover, monitor and protect data stored in s3 buckets.
    Automated discovery of PII, PHI and financial data.
    It is multi account based generally use in organization.

    It consists of ,
        Managed data identifiers    -   Uses AI/MI 
        Custom data identifiers     -   Customer create using Regexp to match pattern in data.

    Mazie -> Schedule job -> Findings -> Event bridge -> Security hub / Lambda.

    There are 2 types of findings, 
        Policy findings - It means encryption disabled, publicaccess disabled, ACL changes policy.
        Sensitive data findings
    
---------------------------------------------------------------------------------------------------------

EBS VOLUME TYPES:

    Deploy in single AZ.
    Support POSIX.

    GENERAL PURPOSE SSD: 
        It consists of GP2, GP3.
        IOPS is one chunk of 16kb in one second.
        Baseline rate - 100 IO credits per second to fill credit.
        Beyond 100 IO, 3 io rate per gb per second.

        GP2: (default)
            SSD based.
            From 1 GB to 16 TB.
            Get 3 IOPS per second per gb.
            Can burst upto 3000 IOPS.
            Great for boot volumes, data backups and database loading.
    
        GP3:
            SSD based.
            3000 IOPS.
            Cheaper than GP2.
            Offers high throughput.

    In gp2, dependsup on the size, iops and thorughput changes. As user dont have option to chose these. With GP3, removed this limitation and user can change iops/throughput. 


    PROVISONED IOPS: 

        It consists of IO1, IO2 & IO2 block express. 
        Achieve a max of 64000 IOPS. upto 256000 for block express.
        Used for low latency application, sub milli second latency requirement.

    HDD (Hard Disk Drive) Based: 

        st1:
            Throughput optimized.
            Read sequential data.
            Max 500 IOPS.
            Useful for bgigdata, data processing.

        sc1:
            Cold HDD.
            For archival data.
            Max 250 IOPS.
            Useful for less frequently accessed data.

    
    INSTANCE STORE VOLUMES: 

        Support POSIX.
        It provide block storage devices.
        NOTE: Instance store volume can be attached only at launch. Unlike EBS, cannot attached after launch instances.
        If instance moves from one host to another, data will be lost.

        It is local on EC2 host.
        Add only at Launch time.
        If instance move, resize, hardware failure, data is lost.
        It gives high performance.
        Temporary data store.


    INSTANCE STORE VS EBS VOLUMES:

        EBS: 
            Data is persistent.
            Resilience
            Have snapshot option.
            Storage isolated from instance cycle.
            
        Instance Store:
            Data is not persistent.
            Not Resilient
            best Cost 

    Pure Cost efficacy - Cheap - st1 or sc1 
    Throughput -    st1.
    Boot - not hdd.
    gp2/3 - upto 16,000 iops.
    io1/2 - upto 64,000 iops.
    io2 block express - 256,000 iops depends upon larger volume size.
    RAID0 + EBS - 260,000 iops.
    more than 260,000 iops - instance store volume.


---------------------------------------------------------------------------------------------------------
COMPUTE, SCALING & LOAD BALANCING: 
---------------------------------------------------------------------------------------------------------

REGIONAL & GLOBAL AWS ARCHITECTURE:

    Global service location & discovery.
    CDN and optimization.
    Global health check and failover.

    Global: 
        Route 53 - DNS Server 
        CDN - Content delivery caching which close to customer.
    Regional: 
        Most services are regional.

        It consists of,
            web tier -  
            app tier -  ec2, lambda 
            storage tier - ebs, efs
            caching layer - DAX (dynamodb cache), elastic cache, redis, memcache
            db tier - redshift, rds etc. 
            app services - sqs, sns


EC2 PURCHASE OPTIONS: 

    On-demand: 
        It is default and pay only for use.
        per second billing only when instances is running.
        It doesnot give any priority access when AWS failure.
        It is suitable for short term workload.

    Spot Pricing: 
        It is cheapest.
        Any ununsed compute is released to AWS.
        AWS set the spot price and customers can quote the price. If customer price is less, then spot instances will be terminated.
        Should not use for critical application which doesnot tolerate interruptions.
    
    Reserved Instances: 
        Longterm usage 
        Unused cannot be released.
        Reservation for 1 year or 3 year
        Payment options,
            No upfront      -   less discount.
            partial upfront -   medium discount.
            Full upfront    -   high discount.
        Schedule Reserved Instances: 
            When require long time environment with specific timing.
            min 1 year commitment.
        Capacity Reservations:
            It is useful when cant tolerate interruptions.
            It consists of billing + capacity component.
            It is of,
                Regional reservation    -   region level across az.
                Zonal reservation   -   at single az level.
                Ondemand capacity reservation - still pay eventhough not use.
        Savings Plan:
            1 or 3 year commitment in hourly spend.
            
    Dedicated Host: 
        Purchase the hosts and instances are hosted in hosts.
        Pay for the hosts and not on instances.
        Use for software license based on sockets or cores (physical machine).
        Only your instances runs on hosts.
        underlying host is customer managed.

    Dedicated Instances:
        Instances are placed in host. No other customer instances are placed under same hosts.
        Pay for entire hosts + instances charge per hour.
        Underlying host is aws managed. 

---------------------------------------------------------------------------------------------------------

EC2 NETWORKING:

    When EC2 created, primary ENI is created automatically. Secondary ENI can be attached during instance creation or added later.
    NOTE: ENI can be in different subnet but should be same AZ.
    Security groups are associated with ENI not EC2.

    ENI: 
        primary private ip4 address.
        1 or more secondary private ip address
        secondary eni can be moved between instances.

    Public IP address is assigned based on subnet settings.

---------------------------------------------------------------------------------------------------------




    




